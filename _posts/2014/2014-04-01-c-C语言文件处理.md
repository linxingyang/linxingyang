---
layout: post
permalink: /:year/bb97a16f894d42aaab09bc92c3785fqq
title: 2014-04-01-c-c语言处理文件
categories: [c]
tags: [c,处理文件]
excerpt: c,处理文件
description: c,处理文件

---


# c文件处理 #
## 文件类型 ##

* 文件类型
	* 二进制文件，
	* 文本文件
* 如果存储字符数据，二者没有区别
* 如果存储非字符数据：
	* 频繁访问和保存的，采用二进制文件
	* 频繁向终端显示或者输入的，采用文本文件

## 文件的打开和关闭 ##

```c

FILE *fopen (char *filename, char *mode);

FILE *fp;
fp = fopen ("a1", "r"); 以读的方式打开 a1
fclose (fp); 关闭

```

## 读和写 ##

```c

fscanf  ,  fprintf  用于文本文件的读写
fread, fwrite 二进制文件
fgetc,fputc 文本与二进制都可以

使用 fscanf, fprintf 和 fread, fwrite 函数时，和 fopen函数中指定的打开模式无关

使用 fgetc, fputc 函数时， 和 fopen函数中的指定的打开模式有关

fgets (str, n , fp), fputs (str, fp)

```

### fscanf fprintf ###

* fscanf (文件指针， 格式 字符串， 输入列表）
* fprintf (文件指针， 格式字符串， 输出列表）


```c

int main ()
{
    FILE *out;
    int i;
    struct student
    {
        int code;
        char name[10];
        int age;
    }a[2];
    if ((out = fopen ("student.txt", "w+")) == NULL)
    {
        printf ("can not output file.");
    }
    for (i = 0; i < 2; i++)
    {
        fscanf (stdin, "%d%s%d", &a[i].code, &a[i].name, &a[i].age);
        fprintf (out, "%d%s%d \n", a[i].code, a[i].name, a[i].age);
    }
    fclose (out);
}

```



### fread fwrite ###

fread (buffer, size, count, fp)
fwrite (buffer, size, coutn, fp)
buffer： 指针，内存中的数据地址
size: 要读写的字节数
count: 要读写的size字节数据的个数
fp: 文件类型指针

```c

#include <stdio.h>
#include <stdlib.h>

int main ()
{
    FILE *out;
    FILE *in;
    int i;

    struct student
    {
        int code;
        char name[10];
        int age;
    }a[2] = { {1, "wxf", 20},{2, "szn", 21}};
    if ((out = fopen ("stu.txt", "wb")) == NULL)
    {
        printf ("can not open output file.");
    }

    for (i = 0; i < 2; i++)
    {
        fwrite (&a[i], sizeof (struct student), 1, out);
    }

    fclose (out);
    if ((in = fopen ("stu.txt", "rb")) == NULL)
    {
        printf ("can not open input file.");
    }
    for (i = 0; i < 2; i++)
    {
        fread (&a[i], sizeof (struct student), 1, in);
        printf ("%d,%3s,%d \n", a[i].code, a[i].name, a[i].age);
    }
    fclose (in);
}

```

### fgetc fput ###
* fgetc 从指定文件读入一个字节的数据
* fput 把一个字节的数据写到磁盘文件

```
#include <stdio.h>
#include <stdlib.h>

int main ()
{
    FILE *fp;
    char ch;

    if ((fp = fopen ("out.txt", "w")) ==NULL)
    {
        printf ("can not open file \n");
    }
    ch = getchar ();
    while (ch != '#')
    {
        fputc (ch, fp);
        ch = getchar ();
    }
    fclose (fp);

}

```

```

fgets (str, n , fp), fputs (str, fp)
fget (str, n fp) 从fp文件中读出 n-1 个字符，然后在最后加一个 '\0' 字符，
如果在读完 n-1 个字符之前遇到换行符或EOF，读入结束。
str为首地址。
fputs ("china", fp) 把字符串 fp 输入到 fp文件中

```

## 文件的定位 ##

### rewind ###
* rewind 使位置指针重新返回文件的开头
* int rewind (FILE *fp) 成功返回 0 ， 否则返回其他值

```c

#include <stdio.h>
#include <stdlib.h>

int main ()
{
    FILE *fp1;
    FILE *fp2;

    fp1 = fopen ("Test2.txt", "r");
    fp2 = fopen ("stu.txt", "w");

    while (!feof (fp1))
    {
        putchar (fgetc (fp1));
    }
    rewind (fp1);

    while (!feof (fp1))
    {
        fputc (fgetc (fp1), fp2);
    }
    fclose (fp1);
    fclose (fp2);

}

```

### fseek ###
fseek 控制文件的位置指针按需要移动到任意位置，利用它可以对文件随机的读写
fseek (文件类型指针， 位移量， 起始点）
其实点用 0，1，2代替，0表示文件开始，1表示当前位置，3表示文件末尾
位移量是以起始点为基准点，fseek一般用于二进制文件，因为文本文件要发生
字符转换，计算位置时常常会发生混乱。

```c

#include <stdio.h>
#include <stdlib.h>

struct student
{
    char name[10];
    int num;
    int age;
    char sex;
}stud[10] =
{
    {"萧峰", 1, 35, 'm'},
    {"郭靖", 2, 25, 'm'},
    {"张无忌", 3, 21, 'm'},
    {"黄蓉", 4, 20, 'w'},
    {"杨过", 5, 28, 'm'},
    {"小昭", 6, 18, 'w'},
    {"杨康", 7, 25, 'm'},
    {"虚竹", 8, 26, 'm'},
    {"段誉", 9, 25, 'm'},
    {"夏雪宜", 10, 32, 'm'},
};

int main ()
{
    FILE *fp;
    int i;
    if ((fp = fopen ("student.txt", "wb")) == NULL)
    {
        printf ("can not open file");
        exit (0);
    }
    for (i = 0; i < 10; i++)
    {
        fwrite (&stud[i], sizeof (struct student), 1, fp);
    }
    for (i = 0; i < 10; i += 2)
    {
        fseek (fp, i * sizeof (struct student), 0);
        fread (&stud[i], sizeof (struct student), 1, fp);
        printf ("姓名:%-6s学号:%d  年龄:%d  性别:%c \n", stud[i].name, stud[i].num, stud[i].age, stud[i].sex);
    }
    fclose (fp);

}

```

### ftell ###

* ftell 返回文件指针的当前位置，用相对于文件开头的位移量来表示。返回 -1L 表示出错

``` c

i = ftell (fp);
if (i == -1L)
printf ("error");

```

## 文件的状态 （好像没怎么用过） ##

### ferror (fp) ###
### clearerr (fp) ###


